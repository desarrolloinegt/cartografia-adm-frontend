(self.webpackChunkcartografia_app=self.webpackChunkcartografia_app||[]).push([[58],{9058:(J,E,a)=>{"use strict";a.r(E),a.d(E,{HomeProjectPageComponent:()=>D,ProjecHometModule:()=>N,ProjectRoutingModule:()=>w});var A=a(9132),t=a(4650),F=a(8443);class d{constructor(e){this.apiService=e}getGroupsProject(e){return this.apiService.getById("obtenerGruposProyecto",e)}guardarJerarquias(e){return this.apiService.patch("jerarquias",e)}getIdProject(e){return this.apiService.getById("proyectoId",e)}}d.\u0275fac=function(e){return new(e||d)(t.LFG(F.s))},d.\u0275prov=t.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"});var h=a(9549),S=a(1572),_=a(3848),b=a(5861),C=a(1206),s=a(574),c=a(7559),v=a(6525),l=a(3995),g=a(5226),m=a.n(g),f=a(4006),T=a(7274),Z=a(4839),U=a(8049),y=a(6895),I=a(4144),j=a(4859),B=a(4954);function K(r,e){1&r&&(t.TgZ(0,"mat-error"),t._uU(1,"Nombre de rol es "),t.TgZ(2,"strong"),t._uU(3,"requerido"),t.qZA()())}function X(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"button",10),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.createGroup())}),t._uU(1," Guardar Rol "),t.qZA()}if(2&r){const o=t.oxw();t.Q6J("disabled",!o.groupForm.valid)}}const $=function(){return["crear-grupo"]};class M{constructor(e,o,n,i,u){this.groupService=e,this.data=o,this.projectService=n,this.formBuilder=i,this.dialogRef=u,this.buildForm()}buildForm(){this.groupForm=this.formBuilder.group({nombre:["",f.kI.required],descripcion:[""],proyecto_id:[this.data,[f.kI.required]]})}get Nombre(){return this.groupForm.get("nombre")}get Descripcion(){return this.groupForm.get("descripcion")}get ProyectoId(){return this.groupForm.get("proyecto_id")}get Jerarquia(){return this.groupForm.get("jerarquia")}submit(){}createGroup(){this.groupForm.valid&&this.groupService.create(this.groupForm.value).subscribe(e=>{1==e.status&&(m().fire("Ok!",e.message,"success"),this.dialogRef.close(1))})}cancelAdd(){this.dialogRef.close()}}M.\u0275fac=function(e){return new(e||M)(t.Y36(Z.GroupService),t.Y36(T.WI),t.Y36(U.Y),t.Y36(f.qu),t.Y36(T.so))},M.\u0275cmp=t.Xpm({type:M,selectors:[["app-new-group-project"]],decls:19,vars:8,consts:[[1,"card"],[1,"card-body"],[3,"formGroup","submit"],[1,"form-group"],["appearance","outline",1,"full-width-input"],["type","text","formControlName","nombre","matInput","","placeholder","Supervisores ENEI","required","",1,"form-control"],[4,"ngIf"],["type","text","formControlName","descripcion","placeholder","Grupo 2026","matInput","",1,"form-control"],["type","submit","mat-raised-button","","color","primary",3,"disabled","click",4,"ngxPermissionsOnly"],["type","submit","mat-stroked-button","","color","warn",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"form",2),t.NdJ("submit",function(){return o.submit()}),t.TgZ(3,"div",3)(4,"mat-form-field",4)(5,"mat-label"),t._uU(6,"Ingrese el Nombre del Rol"),t.qZA(),t._UZ(7,"input",5),t.YNc(8,K,4,0,"mat-error",6),t.qZA()(),t.TgZ(9,"div",3)(10,"mat-form-field",4)(11,"mat-label"),t._uU(12,"Descripcion(Opcional)"),t.qZA(),t._UZ(13,"input",7),t.qZA()(),t.TgZ(14,"div",3),t.YNc(15,X,2,1,"button",8),t._UZ(16,"br"),t.TgZ(17,"button",9),t.NdJ("click",function(){return o.cancelAdd()}),t._uU(18," Cancelar "),t.qZA()()()()()),2&e&&(t.xp6(2),t.Q6J("formGroup",o.groupForm),t.xp6(3),t.Udp("font-size",16,"px"),t.xp6(3),t.Q6J("ngIf",(null==o.Nombre?null:o.Nombre.touched)&&(null==o.Nombre?null:o.Nombre.hasError("required"))),t.xp6(3),t.Udp("font-size",16,"px"),t.xp6(4),t.Q6J("ngxPermissionsOnly",t.DdM(7,$)))},dependencies:[y.O5,h.KE,h.hX,h.TO,I.Nt,j.lW,f._Y,f.Fj,f.JJ,f.JL,f.Q7,f.sg,f.u,B.gE],styles:[".full-width-input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{width:100%;max-width:98%;margin:0 auto;display:flex}.example-section[_ngcontent-%COMP%]{max-width:98%;margin:0 auto;display:flex}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}.card[_ngcontent-%COMP%]{padding:3rem}"]});var p=a(7155),Y=a(7392),Q=a(266);const W=["table"];function V(r,e){1&r&&(t.TgZ(0,"mat-header-cell"),t._uU(1,"ID"),t.qZA())}function tt(r,e){if(1&r&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.id)}}function et(r,e){1&r&&(t.TgZ(0,"mat-header-cell"),t._uU(1,"Nombre"),t.qZA())}function ot(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"mat-cell")(1,"mat-icon",16),t.NdJ("mousedown",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.dragDisabled=!1)}),t._uU(2,"reorder"),t.qZA(),t.TgZ(3,"span"),t._uU(4),t.qZA()()}if(2&r){const o=e.$implicit;t.xp6(4),t.Oqu(o.nombre)}}function rt(r,e){1&r&&(t.TgZ(0,"mat-header-cell"),t._uU(1,"Jerarquia"),t.qZA())}function nt(r,e){if(1&r&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.jerarquia)}}function it(r,e){1&r&&(t.TgZ(0,"mat-header-cell"),t._uU(1,"Descripcion"),t.qZA())}function at(r,e){if(1&r&&(t.TgZ(0,"mat-cell"),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.descripcion)}}function st(r,e){1&r&&(t.TgZ(0,"mat-header-cell"),t._uU(1,"Acciones"),t.qZA())}function ct(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"button",23),t.NdJ("click",function(){t.CHM(o);const i=t.oxw().$implicit,u=t.oxw();return t.KtG(u.editar(i.id,i.nombre,i.descripcion,i.proyecto_id))}),t.TgZ(1,"mat-icon",24),t._uU(2,"edit"),t.qZA()()}}function ut(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"button",25),t.NdJ("click",function(){t.CHM(o);const i=t.oxw().$implicit,u=t.oxw();return t.KtG(u.desactivar(i.id,i.nombre))}),t.TgZ(1,"mat-icon",26),t._uU(2,"delete"),t.qZA()()}}function lt(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(o);const i=t.oxw().$implicit,u=t.oxw();return t.KtG(u.verUsuarios(i.id,i.nombre))}),t.TgZ(1,"mat-icon"),t._uU(2,"supervised_user_circle"),t.qZA()()}}function pt(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(o);const i=t.oxw().$implicit,u=t.oxw();return t.KtG(u.verRoles(i.id,i.nombre))}),t.TgZ(1,"mat-icon"),t._uU(2,"list_alt"),t.qZA()()}}const mt=function(){return["editar-grupo"]},dt=function(){return["desactivar-grupo"]},gt=function(){return["asignar-usuario-grupo"]},ft=function(){return["asignar-rol-grupo"]};function _t(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"mat-cell"),t.YNc(1,ct,3,0,"button",17),t.YNc(2,ut,3,0,"button",18),t.YNc(3,lt,3,0,"button",19),t.TgZ(4,"button",20),t.NdJ("click",function(){const u=t.CHM(o).$implicit,x=t.oxw();return t.KtG(x.addUser(u.id))}),t.TgZ(5,"mat-icon"),t._uU(6,"add"),t.qZA()(),t.TgZ(7,"button",21),t.NdJ("click",function(){const u=t.CHM(o).$implicit,x=t.oxw();return t.KtG(x.addFile(u.id))}),t.TgZ(8,"mat-icon"),t._uU(9,"arrow_upward"),t.qZA()(),t.YNc(10,pt,3,0,"button",22),t.qZA()}2&r&&(t.xp6(1),t.Q6J("ngxPermissionsOnly",t.DdM(4,mt)),t.xp6(1),t.Q6J("ngxPermissionsOnly",t.DdM(5,dt)),t.xp6(1),t.Q6J("ngxPermissionsOnly",t.DdM(6,gt)),t.xp6(7),t.Q6J("ngxPermissionsOnly",t.DdM(7,ft)))}function ht(r,e){1&r&&t._UZ(0,"mat-header-row")}function bt(r,e){1&r&&t._UZ(0,"mat-row",29),2&r&&t.Q6J("cdkDragData",e.$implicit)}function vt(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.createGroup())}),t.TgZ(1,"mat-icon",31),t._uU(2,"add"),t.qZA()()}}const xt=function(){return["crear-grupo"]};class G{constructor(e,o,n){this.projectHomeService=e,this.groupService=o,this.dialogService=n,this.data=[],this.displayedColumns=["nombre","descripcion","options"],this.dragDisabled=!0,this.project="",this.group={id:0,jerarquia:0,nombre:"",descripcion:"",proyecto_id:0,proyecto:""},this.userData={username:"",grupo_id:0},this.roleData={id:0,nombre:"",roles:[]},this.userDataFile={grupo_id:0,usuarios:[]}}ngOnInit(){this.project=localStorage.getItem("project")||"",this.cargarGrupos()}drop(e){this.dragDisabled=!0,this.dataSource.find(u=>u==e.item.data);const i=this.dataSource.findIndex(u=>u==e.item.data);(0,C.bA)(this.dataSource,i,e.currentIndex),this.table.renderRows(),this.ordenarJerarquias()}ordenarJerarquias(){for(let e=0;e<this.dataSource.length;e++)for(let o=0;o<this.dataSource.length;o++)(this.dataSource[e].jerarquia>this.dataSource[o].jerarquia||this.dataSource[e].jerarquia==this.dataSource[o].jerarquia)&&(this.dataSource[e].jerarquia=this.dataSource.length-e)}desactivar(e,o){m().fire({title:"\xbfEsta seguro que desea Desactivar el rol: "+o+"?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(n=>{n.isConfirmed?this.groupService.desactiveGroup(Number(e)).subscribe(i=>{1==i.status&&(this.cargarGrupos(),m().fire("Ok!","Rol desactivado","success"))}):n.isDenied&&m().fire("Cambios no guardados","","info")})}editar(e,o,n,i){this.group.id=Number(e),this.group.nombre=o,this.group.descripcion=n,this.group.proyecto_id=Number(i),this.dialogService.open(c.e,{height:"20rem",width:"50rem",data:this.group}).afterClosed().subscribe(x=>{1===x&&this.cargarGrupos()})}addUser(e){var o=this;return(0,b.Z)(function*(){const{value:n}=yield m().fire({title:"Usuario",input:"text",inputPlaceholder:"juan2022",confirmButtonText:"Agregar Usuario",showCancelButton:!0,inputLabel:"Ingrese el nombre de usuario"});n&&(o.userData.grupo_id=Number(e),o.userData.username=n,o.groupService.addUserToGroup(o.userData).subscribe(i=>{1==i.status&&m().fire("Ok!",i.message,"success")}))})()}addFile(e){var o=this;return(0,b.Z)(function*(){const{value:n}=yield m().fire({title:"Seleccione archivo",input:"file",inputAttributes:{accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(n){o.userDataFile.grupo_id=Number(e);const i=new FileReader;i.onload=u=>{const R=s.ij(u.target.result,{type:"binary"});o.data=s.P6.sheet_to_json(R.Sheets[R.SheetNames[0]],{header:1}),o.generateJsonUsers()},i.readAsBinaryString(n)}})()}generateJsonUsers(){var e=this;return(0,b.Z)(function*(){e.userDataFile.usuarios=[],e.data.forEach(o=>{e.userDataFile.usuarios.push(o.toString())}),e.userDataFile.usuarios=e.userDataFile.usuarios.filter(Boolean),e.groupService.assignGroupUsersFile(e.userDataFile).subscribe(o=>{1==o.status&&m().fire("Ok",o.message,"success")})})()}guardarJerarquias(){m().fire({title:"Guardar orden de los roles",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(e=>{e.isConfirmed?this.projectHomeService.guardarJerarquias(this.dataSource).subscribe(o=>{1==o.status&&(this.cargarGrupos(),m().fire("Ok!","Organizacion Actualizada","success"))}):e.isDenied&&m().fire("Cambios no guardados","","info")})}cargarGrupos(){this.projectHomeService.getGroupsProject(this.project).subscribe(e=>{this.dataSource=e;for(let o=0;o<this.dataSource.length;o++)0==this.dataSource[o].jerarquia&&(this.dataSource[o].jerarquia=this.dataSource.length-o)})}verUsuarios(e,o){this.userData.grupo_id=Number(e),this.dialogService.open(l.Z,{height:"40rem",width:"50rem",data:this.userData})}verRoles(e,o){this.roleData.id=Number(e),this.roleData.nombre=o,this.groupService.getGroupsRoles(this.roleData.id).subscribe(n=>{this.roleData.roles=n,this.dialogService.open(v.a,{height:"30rem",width:"50rem",data:this.roleData})})}createGroup(){this.projectHomeService.getIdProject(this.project).subscribe(e=>{this.dialogService.open(M,{height:"22rem",width:"50rem",data:Number(e)}).afterClosed().subscribe(i=>{1===i&&this.cargarGrupos()})})}}G.\u0275fac=function(e){return new(e||G)(t.Y36(d),t.Y36(Z.GroupService),t.Y36(T.uw))},G.\u0275cmp=t.Xpm({type:G,selectors:[["app-group-project"]],viewQuery:function(e,o){if(1&e&&t.Gf(W,7),2&e){let n;t.iGM(n=t.CRH())&&(o.table=n.first)}},decls:30,vars:6,consts:[[1,"mat-elevation-z8","table_div"],[1,"orden_label"],["mat-table","","cdkDropList","","cdkDropListData","datasource",1,"table",3,"dataSource","cdkDropListDisabled","cdkDropListDropped"],["table",""],["matColumnDef","id"],[4,"matHeaderCellDef"],[4,"matCellDef"],["matColumnDef","nombre","sticky",""],["matColumnDef","jerarquia"],["matColumnDef","descripcion"],["matColumnDef","options"],[4,"matHeaderRowDef"],["cdkDrag","",3,"cdkDragData",4,"matRowDef","matRowDefColumns"],[1,"header"],["mat-fab","","color","accent","matTooltip","Crear Rol",3,"click",4,"ngxPermissionsOnly"],["matTooltip","Guardar Organizacion","mat-fab","","color","primary",3,"click"],[1,"dragCursor",3,"mousedown"],["mat-icon-button","","matTooltip","Editar","color","primary","class","iconbutton",3,"click",4,"ngxPermissionsOnly"],["mat-icon-button","","matTooltip","Desactivar","color","warn","class","iconbutton",3,"click",4,"ngxPermissionsOnly"],["mat-icon-button","","matTooltip","Ver usuarios","color","primary","class","iconbutton",3,"click",4,"ngxPermissionsOnly"],["mat-icon-button","","matTooltip","Agregar usuario","color","primary",3,"click"],["mat-icon-button","","matTooltip","Cargar archivo","color","primary",3,"click"],["mat-icon-button","","matTooltip","Ver politicas","color","primary","class","iconbutton",3,"click",4,"ngxPermissionsOnly"],["mat-icon-button","","matTooltip","Editar","color","primary",1,"iconbutton",3,"click"],["aria-label","Edit"],["mat-icon-button","","matTooltip","Desactivar","color","warn",1,"iconbutton",3,"click"],["aria-label","Delete"],["mat-icon-button","","matTooltip","Ver usuarios","color","primary",1,"iconbutton",3,"click"],["mat-icon-button","","matTooltip","Ver politicas","color","primary",1,"iconbutton",3,"click"],["cdkDrag","",3,"cdkDragData"],["mat-fab","","color","accent","matTooltip","Crear Rol",3,"click"],["aria-label","add"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t._UZ(1,"br")(2,"br"),t.TgZ(3,"mat-label",1)(4,"strong"),t._uU(5,"Ordene los grupos de mayor a menor"),t.qZA()(),t.TgZ(6,"table",2,3),t.NdJ("cdkDropListDropped",function(i){return o.drop(i)}),t.ynx(8,4),t.YNc(9,V,2,0,"mat-header-cell",5),t.YNc(10,tt,2,1,"mat-cell",6),t.BQk(),t.ynx(11,7),t.YNc(12,et,2,0,"mat-header-cell",5),t.YNc(13,ot,5,1,"mat-cell",6),t.BQk(),t.ynx(14,8),t.YNc(15,rt,2,0,"mat-header-cell",5),t.YNc(16,nt,2,1,"mat-cell",6),t.BQk(),t.ynx(17,9),t.YNc(18,it,2,0,"mat-header-cell",5),t.YNc(19,at,2,1,"mat-cell",6),t.BQk(),t.ynx(20,10),t.YNc(21,st,2,0,"mat-header-cell",5),t.YNc(22,_t,11,8,"mat-cell",6),t.BQk(),t.YNc(23,ht,1,0,"mat-header-row",11),t.YNc(24,bt,1,1,"mat-row",12),t.qZA()(),t.TgZ(25,"div",13),t.YNc(26,vt,3,0,"button",14),t.TgZ(27,"button",15),t.NdJ("click",function(){return o.guardarJerarquias()}),t.TgZ(28,"mat-icon"),t._uU(29,"save"),t.qZA()()()),2&e&&(t.xp6(6),t.Q6J("dataSource",o.dataSource)("cdkDropListDisabled",o.dragDisabled),t.xp6(17),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns),t.xp6(2),t.Q6J("ngxPermissionsOnly",t.DdM(5,xt)))},dependencies:[h.hX,j.RK,j.cs,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,Y.Hw,Q.gM,B.gE,C.Wj,C.Zt],styles:[".table[_ngcontent-%COMP%]{width:100%;margin:0 0 3rem}.table_div[_ngcontent-%COMP%]{width:100%}.mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%;max-width:98%;margin:0 auto;display:flex}.full-width-input[_ngcontent-%COMP%]{width:100% auto;padding:1em}.example-section[_ngcontent-%COMP%]{margin:12px}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin:1.5rem;padding:0 .4rem;font-family:Roboto,Helvetica Neue,sans-serif}.orden_label[_ngcontent-%COMP%]{text-align:center;padding-left:2rem;color:red}.dragCursor[_ngcontent-%COMP%]{cursor:move}"]});var L=a(8739),z=a(6308);function Ct(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Departamento"),t.qZA())}function yt(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.departamento)}}function Tt(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Municipio"),t.qZA())}function Ut(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.municipio)}}function Zt(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"UPM"),t.qZA())}function jt(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.upm)}}function Pt(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Estado"),t.qZA())}function wt(r,e){if(1&r&&(t.TgZ(0,"td",21),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.xp6(1),t.Oqu(o.estado)}}function At(r,e){1&r&&(t.TgZ(0,"th",20),t._uU(1,"Acciones"),t.qZA())}function St(r,e){if(1&r){const o=t.EpF();t.TgZ(0,"td",21)(1,"button",22),t.NdJ("click",function(){const u=t.CHM(o).$implicit,x=t.oxw();return t.KtG(x.sustituirUpm(u.id))}),t.TgZ(2,"mat-icon"),t._uU(3,"loop"),t.qZA()()()}}function Dt(r,e){1&r&&t._UZ(0,"tr",23)}function Nt(r,e){1&r&&t._UZ(0,"tr",24)}function Mt(r,e){if(1&r&&(t.TgZ(0,"tr",25)(1,"td",26),t._uU(2),t.qZA()()),2&r){t.oxw();const o=t.MAs(18);t.xp6(2),t.hij(' No hay resultados de "',o.value,'" ')}}const Gt=function(){return[10,25,100]};class O{constructor(e,o,n,i){this.formBuilder=e,this.dialog=o,this.homeProjectService=n,this.projectService=i,this.displayedColumns=["departamento","municipio","upm","estado","options"],this.data=[],this.assignment={proyecto_id:0,upms:[]},this.upmDataSust={proyecto_id:0,upm_nuevo:"",upm_anterior:0},this.dataSource=new p.by,this.buildForm()}buildForm(){this.formUpms=this.formBuilder.group({file:[""]})}ngOnInit(){this.homeProjectService.getIdProject(localStorage.getItem("project")||"").subscribe(e=>{this.idProject=e,this.cargarUpmsAsignadas()})}applyFilter(e){this.dataSource.filter=e.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}cargarUpmsAsignadas(){0!=this.idProject&&this.projectService.getUpms(this.idProject).subscribe(e=>{this.dataSource=new p.by(e),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})}addUpm(){var e=this;return(0,b.Z)(function*(){const{value:o}=yield m().fire({title:"UPM",input:"text",inputPlaceholder:"AEE001122337A2",confirmButtonText:"Agregar UPM",showCancelButton:!0,inputLabel:"Ingrese la UPM"});o&&(e.assignment.proyecto_id=e.idProject,e.assignment.upms=[o],e.projectService.assignUpmToProject(e.assignment).subscribe(n=>{1==n.status&&(e.cargarUpmsAsignadas(),m().fire("Ok!",n.message,"success"))}))})()}sustituirUpm(e){var o=this;return(0,b.Z)(function*(){o.upmDataSust.proyecto_id=o.idProject,o.upmDataSust.upm_anterior=Number(e);const{value:n}=yield m().fire({title:"UPM",input:"text",inputPlaceholder:"AEE001122337A2",confirmButtonText:"Ok",showCancelButton:!0,inputLabel:"Ingrese la UPM"});n&&(o.upmDataSust.upm_nuevo=n,o.projectService.sustituirUpm(o.upmDataSust).subscribe(i=>{1==i.status&&(o.cargarUpmsAsignadas(),m().fire("Ok!",i.message,"success"))}))})()}addFile(){var e=this;return(0,b.Z)(function*(){const{value:o}=yield m().fire({title:"Seleccione archivo",input:"file",inputAttributes:{accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}});if(o){const n=new FileReader;n.onload=i=>{const x=s.ij(i.target.result,{type:"binary"});e.data=s.P6.sheet_to_json(x.Sheets[x.SheetNames[0]],{header:1}),e.generateJson()},n.readAsBinaryString(o)}})()}generateJson(){this.idProject&&(this.assignment.proyecto_id=this.idProject,this.data.forEach(e=>{this.assignment.upms.push(e.toString())})),console.log(this.assignment),this.projectService.assignUpmToProject(this.assignment).subscribe(e=>{1==e.status&&(this.cargarUpmsAsignadas(),m().fire("Ok!",e.message,"success"))})}}O.\u0275fac=function(e){return new(e||O)(t.Y36(f.qu),t.Y36(T.uw),t.Y36(d),t.Y36(U.Y))},O.\u0275cmp=t.Xpm({type:O,selectors:[["app-upms"]],viewQuery:function(e,o){if(1&e&&(t.Gf(L.NW,5),t.Gf(z.YE,5)),2&e){let n;t.iGM(n=t.CRH())&&(o.paginator=n.first),t.iGM(n=t.CRH())&&(o.sort=n.first)}},decls:41,vars:5,consts:[[1,"container"],["matTooltip","Agregar UPM","mat-flat-button","","color","accent",2,"margin-right","8px",3,"click"],[1,"upms"],["mat-flat-button","","color","accent","matTooltip","Cargar archivo con UPM'S",3,"click"],["matInput","","placeholder","Ex. Mia",3,"keyup"],["input",""],[1,"mat-elevation-z8"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","departamento"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","municipio"],["matColumnDef","upm"],["matColumnDef","estado"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],[3,"pageSizeOptions"],["paginator",""],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","matTooltip","Reemplazar","color","primary",1,"iconbutton",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(e,o){1&e&&(t._UZ(0,"br")(1,"br"),t.TgZ(2,"div")(3,"div",0)(4,"div")(5,"button",1),t.NdJ("click",function(){return o.addUpm()}),t._uU(6," Agregar "),t.qZA()(),t.TgZ(7,"div",2)(8,"button",3),t.NdJ("click",function(){return o.addFile()}),t.TgZ(9,"mat-icon"),t._uU(10,"arrow_upward"),t.qZA(),t._uU(11," Cargar Archivo "),t.qZA()()()(),t._UZ(12,"br")(13,"br"),t.TgZ(14,"mat-form-field")(15,"mat-label"),t._uU(16,"Buscar"),t.qZA(),t.TgZ(17,"input",4,5),t.NdJ("keyup",function(i){return o.applyFilter(i)}),t.qZA()(),t.TgZ(19,"div",6)(20,"table",7),t.ynx(21,8),t.YNc(22,Ct,2,0,"th",9),t.YNc(23,yt,2,1,"td",10),t.BQk(),t.ynx(24,11),t.YNc(25,Tt,2,0,"th",9),t.YNc(26,Ut,2,1,"td",10),t.BQk(),t.ynx(27,12),t.YNc(28,Zt,2,0,"th",9),t.YNc(29,jt,2,1,"td",10),t.BQk(),t.ynx(30,13),t.YNc(31,Pt,2,0,"th",9),t.YNc(32,wt,2,1,"td",10),t.BQk(),t.ynx(33,14),t.YNc(34,At,2,0,"th",9),t.YNc(35,St,4,0,"td",10),t.BQk(),t.YNc(36,Dt,1,0,"tr",15),t.YNc(37,Nt,1,0,"tr",16),t.YNc(38,Mt,3,1,"tr",17),t.qZA(),t._UZ(39,"mat-paginator",18,19),t.qZA()),2&e&&(t.xp6(20),t.Q6J("dataSource",o.dataSource),t.xp6(16),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns),t.xp6(2),t.Q6J("pageSizeOptions",t.DdM(4,Gt)))},dependencies:[h.KE,h.hX,I.Nt,j.lW,j.RK,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,p.Ee,Y.Hw,L.NW,Q.gM,z.YE],styles:[".table[_ngcontent-%COMP%]{width:100%;margin:0 0 3rem}.table_div[_ngcontent-%COMP%]{width:100%}.mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%;max-width:98%;margin:0 auto;display:flex}.full-width-input[_ngcontent-%COMP%]{width:100% auto;padding:1em}.example-section[_ngcontent-%COMP%]{margin:12px}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;margin:1.5rem;padding:0 .4rem;font-family:Roboto,Helvetica Neue,sans-serif}.container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center}.upms[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font:1rem/1.5 PT Sans,Arial,sans-serif;color:#5a5a5a}"]});var Ot=a(4327);class P{constructor(){}exportAsExcelFile(e,o){const i={Sheets:{data:s.P6.json_to_sheet(e)},SheetNames:["data"]},u=s.cW(i,{bookType:"xlsx",type:"array"});this.saveAsExcelFile(u,o)}saveAsExcelFile(e,o){const n=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});Ot.saveAs(n,o+"_export_"+(new Date).getTime()+".xlsx")}}P.\u0275fac=function(e){return new(e||P)},P.\u0275prov=t.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"});var Et=a(4385),Ft=a(3238);function Yt(r,e){if(1&r&&(t.TgZ(0,"mat-option",7),t._uU(1),t.qZA()),2&r){const o=e.$implicit;t.Q6J("value",o.id+","+o.nombre),t.xp6(1),t.hij(" ",o.nombre," ")}}class k{constructor(e,o,n,i){this.groupService=e,this.projectHomeService=o,this.projectService=n,this.excelService=i,this.users={personal:"",encargado:""},this.usersFile=[],this.usernames=[],this.projectUserAssignment={usuario_id:0,proyecto_id:0}}ngOnInit(){let e=localStorage.getItem("id");Number(e)&&(this.projectUserAssignment.usuario_id=Number(e),this.projectHomeService.getIdProject(localStorage.getItem("project")||"").subscribe(o=>{this.projectUserAssignment.proyecto_id=o,this.getGroupsMinor()})),this.projectHomeService.getIdProject(localStorage.getItem("project")||"").subscribe(o=>{this.idProject=o})}getGroupsMinor(){var e=this;return(0,b.Z)(function*(){e.groupService.getGroupsMinor(e.projectUserAssignment).subscribe(o=>{e.groups=o})})()}getUsers(e){let o=e.split(",");this.groupService.getGroupsUsers(Number(o[0])).subscribe(n=>{this.usernames=n,this.usernames.forEach(i=>{this.usersFile.push(this.users={encargado:"",personal:i.username})}),this.excelService.exportAsExcelFile(this.usersFile,o[1])})}}k.\u0275fac=function(e){return new(e||k)(t.Y36(Z.GroupService),t.Y36(d),t.Y36(U.Y),t.Y36(P))},k.\u0275cmp=t.Xpm({type:k,selectors:[["app-personal-monitor"]],decls:20,vars:4,consts:[[1,"container"],["appearance","outline",2,"width","25rem"],["rol",""],[3,"value",4,"ngFor","ngForOf"],["mat-flat-button","","color","accent",3,"disabled","click"],[1,"upms"],["mat-flat-button","","color","accent"],[3,"value"]],template:function(e,o){if(1&e){const n=t.EpF();t._UZ(0,"br")(1,"br"),t.TgZ(2,"div",0)(3,"div")(4,"mat-form-field",1)(5,"mat-label"),t._uU(6,"Seleccione un Rol"),t.qZA(),t.TgZ(7,"mat-select",null,2),t.YNc(9,Yt,2,2,"mat-option",3),t.qZA()()(),t.TgZ(10,"div")(11,"button",4),t.NdJ("click",function(){t.CHM(n);const u=t.MAs(8);return t.KtG(o.getUsers(u.value))}),t.TgZ(12,"mat-icon"),t._uU(13,"arrow_downward"),t.qZA(),t._uU(14," Descargar Plantilla "),t.qZA()(),t.TgZ(15,"div",5)(16,"button",6)(17,"mat-icon"),t._uU(18,"arrow_upward"),t.qZA(),t._uU(19," Cargar Archivo "),t.qZA()()()}if(2&e){const n=t.MAs(8);t.xp6(5),t.Udp("font-size",16,"px"),t.xp6(4),t.Q6J("ngForOf",o.groups),t.xp6(2),t.Q6J("disabled",!n.value)}},dependencies:[y.sg,h.KE,h.hX,j.lW,Y.Hw,Et.gD,Ft.ey],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center}"]});class q{constructor(e,o,n,i){this.groupService=e,this.projectHomeService=o,this.projectService=n,this.excelService=i,this.datos=[],this.userUpm={personal:"",upm:""},this.nameUpms=[],this.projectUserAssignment={usuario_id:0,proyecto_id:0}}ngOnInit(){let e=localStorage.getItem("id");Number(e)&&(this.projectUserAssignment.usuario_id=Number(e),this.projectHomeService.getIdProject(localStorage.getItem("project")||"").subscribe(o=>{this.projectUserAssignment.proyecto_id=o,this.idProject=o,this.getGroupsMinor()}))}getGroupsMinor(){var e=this;return(0,b.Z)(function*(){e.groupService.getGroupsMinor(e.projectUserAssignment).subscribe(o=>{e.groups=o})})()}cargarUpmsAsignadas(){var e=this;return(0,b.Z)(function*(){Number(e.idProject)&&e.projectService.getUpms(e.idProject).subscribe(o=>{o.forEach(n=>{e.nameUpms.push(n.upm)}),e.createFile()})})()}createFile(){this.datos=[];for(let e=0;e<this.nameUpms.length;e++)this.userUpm={personal:" ",upm:this.nameUpms[e]},this.datos.push(this.userUpm);this.excelService.exportAsExcelFile(this.datos,"AsignacionUPMS")}}q.\u0275fac=function(e){return new(e||q)(t.Y36(Z.GroupService),t.Y36(d),t.Y36(U.Y),t.Y36(P))},q.\u0275cmp=t.Xpm({type:q,selectors:[["app-personal-upms"]],decls:13,vars:0,consts:[[1,"container"],["mat-flat-button","","color","accent",3,"click"],[1,"upms"],["mat-flat-button","","color","accent"]],template:function(e,o){1&e&&(t._UZ(0,"br")(1,"br"),t.TgZ(2,"div",0)(3,"div")(4,"button",1),t.NdJ("click",function(){return o.cargarUpmsAsignadas()}),t.TgZ(5,"mat-icon"),t._uU(6,"arrow_downward"),t.qZA(),t._uU(7," Descargar Plantilla "),t.qZA()(),t.TgZ(8,"div",2)(9,"button",3)(10,"mat-icon"),t._uU(11,"arrow_upward"),t.qZA(),t._uU(12," Cargar Archivo "),t.qZA()()())},dependencies:[j.lW,Y.Hw],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center}"]});class D{constructor(e,o){this.router=e,this.projectHomeService=o,this.projectId=0,this.roles=[]}ngOnInit(){this.project=localStorage.getItem("project")||"",this.project||this.router.navigateByUrl("home")}}D.\u0275fac=function(e){return new(e||D)(t.Y36(A.F0),t.Y36(d))},D.\u0275cmp=t.Xpm({type:D,selectors:[["app-home-project-page"]],decls:35,vars:5,consts:[[1,"grid-container"],[1,"frow-container"],[1,"col-sm-1-1","col-sm-6-12","col-md-6-12"],[1,"header"],["color","primary","mode","determinate","value","45"],["color","accent"],["label","Roles"],["label","UPM'S"],["label","Asignar Personal y UPM's"],["label","Asignar UPM'S"],["label","Equipos de Campo"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2"),t._uU(5),t.qZA(),t.TgZ(6,"div")(7,"h3")(8,"mat-label"),t._uU(9,"Progreso Total"),t.qZA()(),t._UZ(10,"mat-progress-spinner",4),t.qZA()()(),t._UZ(11,"br")(12,"br")(13,"br"),t.TgZ(14,"div")(15,"mat-tab-group",5)(16,"mat-tab",6),t._UZ(17,"app-group-project"),t.qZA(),t.TgZ(18,"mat-tab",7),t._UZ(19,"app-upms"),t.qZA(),t.TgZ(20,"mat-tab",8),t._UZ(21,"br")(22,"hr"),t.TgZ(23,"label"),t._uU(24,"Personal"),t.qZA(),t._UZ(25,"app-personal-monitor")(26,"br")(27,"hr"),t.TgZ(28,"label"),t._uU(29,"UPM's"),t.qZA(),t._UZ(30,"app-personal-upms"),t.qZA(),t.TgZ(31,"mat-tab",9),t._UZ(32,"app-personal-upms"),t.qZA(),t.TgZ(33,"mat-tab",10),t._uU(34,"Content 3"),t.qZA()()()()()),2&e&&(t.xp6(5),t.Oqu(o.project),t.xp6(18),t.Udp("font-size",16,"px"),t.xp6(5),t.Udp("font-size",16,"px"))},dependencies:[h.hX,S.Ou,_.uX,_.SP,G,O,k,q],styles:[".header[_ngcontent-%COMP%]{padding-top:2rem;display:flex;justify-content:space-around;align-items:center}.progress-upms[_ngcontent-%COMP%]{padding-top:3.5rem;display:flex;justify-content:space-around;flex-wrap:wrap}.upm-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;height:12rem;width:14rem}.grid-example-square[_ngcontent-%COMP%]{justify-content:end}"]});const Rt=[{path:"",component:D}];class w{}w.\u0275fac=function(e){return new(e||w)},w.\u0275mod=t.oAB({type:w}),w.\u0275inj=t.cJS({imports:[A.Bz.forChild(Rt),A.Bz]});var Jt=a(4657);class N{}N.\u0275fac=function(e){return new(e||N)},N.\u0275mod=t.oAB({type:N}),N.\u0275inj=t.cJS({imports:[y.ez,w,Jt.M,f.UX,B.VI,C._t]})},4327:function(J,E){var a,t;void 0!==(t="function"==typeof(a=function(){"use strict";function d(s,c,v){var l=new XMLHttpRequest;l.open("GET",s),l.responseType="blob",l.onload=function(){C(l.response,c,v)},l.onerror=function(){console.error("could not download file")},l.send()}function h(s){var c=new XMLHttpRequest;c.open("HEAD",s,!1);try{c.send()}catch{}return 200<=c.status&&299>=c.status}function S(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(c)}}var _="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,b=_.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),C=_.saveAs||("object"!=typeof window||window!==_?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(s,c,v){var l=_.URL||_.webkitURL,g=document.createElement("a");g.download=c=c||s.name||"download",g.rel="noopener","string"==typeof s?(g.href=s,g.origin===location.origin?S(g):h(g.href)?d(s,c,v):S(g,g.target="_blank")):(g.href=l.createObjectURL(s),setTimeout(function(){l.revokeObjectURL(g.href)},4e4),setTimeout(function(){S(g)},0))}:"msSaveOrOpenBlob"in navigator?function(s,c,v){if(c=c||s.name||"download","string"!=typeof s)navigator.msSaveOrOpenBlob(function F(s,c){return typeof c>"u"?c={autoBom:!1}:"object"!=typeof c&&(console.warn("Deprecated: Expected third argument to be a object"),c={autoBom:!c}),c.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\ufeff",s],{type:s.type}):s}(s,v),c);else if(h(s))d(s,c,v);else{var l=document.createElement("a");l.href=s,l.target="_blank",setTimeout(function(){S(l)})}}:function(s,c,v,l){if((l=l||open("","_blank"))&&(l.document.title=l.document.body.innerText="downloading..."),"string"==typeof s)return d(s,c,v);var g="application/octet-stream"===s.type,m=/constructor/i.test(_.HTMLElement)||_.safari,f=/CriOS\/[\d]+/.test(navigator.userAgent);if((f||g&&m||b)&&typeof FileReader<"u"){var T=new FileReader;T.onloadend=function(){var y=T.result;y=f?y:y.replace(/^data:[^;]*;/,"data:attachment/file;"),l?l.location.href=y:location=y,l=null},T.readAsDataURL(s)}else{var Z=_.URL||_.webkitURL,U=Z.createObjectURL(s);l?l.location=U:location.href=U,l=null,setTimeout(function(){Z.revokeObjectURL(U)},4e4)}});_.saveAs=C.saveAs=C,J.exports=C})?a.apply(E,[]):a)&&(J.exports=t)}}]);