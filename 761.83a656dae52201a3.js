"use strict";(self.webpackChunkcartografia_app=self.webpackChunkcartografia_app||[]).push([[761],{761:(ie,x,r)=>{r.r(x),r.d(x,{RolesModule:()=>p,RolesPageComponent:()=>u,RolesRoutingModule:()=>d});var N=r(8739),w=r(6308),m=r(7155),O=r(5226),g=r.n(O),n=r(4006),b=r(7274),e=r(4650),Z=r(5357),f=r(6895),c=r(9549),T=r(4144),C=r(4859),P=r(6338),y=r(6709),R=r(4954);function A(i,t){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Nombre es "),e.TgZ(2,"strong"),e._uU(3,"requerido"),e.qZA()())}function M(i,t){if(1&i&&(e.TgZ(0,"mat-list-option",15),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.Q6J("selected",o.checked)("value",o.id),e.xp6(1),e.hij(" ",o.alias," ")}}function U(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(o);const s=e.oxw();return e.KtG(s.editRole())}),e._uU(1," Editar Usuario "),e.qZA()}if(2&i){const o=e.oxw();e.Q6J("disabled",!o.editForm.valid)}}const E=function(){return["editar-rol"]};class h{constructor(t,o,a,s){this.roleService=t,this.dialogRef=o,this.data=a,this.formBuilder=s,this.checked=!1,this.selectedPermision=[],this.permisosList=[],this.defaultPermisos=[],this.asignacionPermisoRolEditado={rol_id:0,permisos:[]},this.buildForm(),this.getPermisos()}submit(){}buildForm(){this.editForm=this.formBuilder.group({rol_id:[this.data.rol_id,[n.kI.required]],nombre:[this.data.nombre,[n.kI.required]],permisos:[{value:[],disabled:!0},[n.kI.required]]})}get Id(){return this.editForm.get("rol_id")}get Nombre(){return this.editForm.get("nombre")}get Permisos(){return this.editForm.get("permisos")}changePermisoStatus(t){this.checked=t,this.checked?this.Permisos?.enable():this.Permisos?.disable()}editRole(){this.editForm.valid&&(this.Permisos?.disabled&&(this.Permisos.setValue(""),this.Permisos.enable()),this.roleService.editRole(this.editForm.value).subscribe(t=>{1==t.status&&(g().fire("Ok!",t.message,"success"),this.dialogRef.close(1))},t=>{console.log(t)}))}getPermisos(){this.roleService.getPermisions().subscribe(t=>{this.permisosList=t,this.permisosList.forEach(o=>{o.checked=!1}),this.defaultPermision()})}defaultPermision(){for(let t=0;t<this.permisosList.length;t++)for(let o=0;o<this.data.permisos.length;o++)this.permisosList[t].alias==this.data.permisos[o]&&(this.permisosList[t].checked=!0)}permisoSelected(t){this.selectedPermision=t.map(o=>o.value)}cancelEdit(){this.dialogRef.close()}}h.\u0275fac=function(t){return new(t||h)(e.Y36(Z.N),e.Y36(b.so),e.Y36(b.WI),e.Y36(n.qu))},h.\u0275cmp=e.Xpm({type:h,selectors:[["app-roles-edit-dialog"]],decls:26,vars:7,consts:[[1,"card"],["mat-dialog-title",""],[1,"card-body"],[3,"formGroup","submit"],[1,"form-group"],["appearance","outline",1,"full-width-input"],["type","text","formControlName","nombre","matInput","","placeholder","admin","required","",1,"form-control"],[4,"ngIf"],[1,"example-margin",3,"checked","change"],[1,"example-section"],["formControlName","permisos",3,"selectionChange"],["permisosLis",""],[3,"selected","value",4,"ngFor","ngForOf"],["type","submit","mat-stroked-button","","color","primary",3,"disabled","click",4,"ngxPermissionsOnly"],["type","submit","mat-stroked-button","","color","warn",3,"click"],[3,"selected","value"],["type","submit","mat-stroked-button","","color","primary",3,"disabled","click"]],template:function(t,o){if(1&t){const a=e.EpF();e.TgZ(0,"div",0)(1,"h3",1),e._uU(2),e.qZA(),e._UZ(3,"br")(4,"br"),e.TgZ(5,"div",2)(6,"form",3),e.NdJ("submit",function(){return o.submit()}),e.TgZ(7,"div",4)(8,"mat-form-field",5)(9,"mat-label"),e._uU(10,"Nombre del rol"),e.qZA(),e._UZ(11,"input",6),e.YNc(12,A,4,0,"mat-error",7),e.qZA()(),e.TgZ(13,"div",4)(14,"mat-checkbox",8),e.NdJ("change",function(l){return o.changePermisoStatus(l.checked)}),e._uU(15," Cambiar Permisos "),e.qZA()(),e.TgZ(16,"div",9)(17,"mat-label"),e._uU(18,"Permisos"),e.qZA(),e.TgZ(19,"mat-selection-list",10,11),e.NdJ("selectionChange",function(){e.CHM(a);const l=e.MAs(20);return e.KtG(o.permisoSelected(l.selectedOptions.selected))}),e.YNc(21,M,2,3,"mat-list-option",12),e.qZA()(),e.TgZ(22,"div",4),e.YNc(23,U,2,1,"button",13),e.TgZ(24,"button",14),e.NdJ("click",function(){return o.cancelEdit()}),e._uU(25," Cancelar "),e.qZA()()()()()}2&t&&(e.xp6(2),e.hij("Rol: ",o.data.nombre,""),e.xp6(4),e.Q6J("formGroup",o.editForm),e.xp6(6),e.Q6J("ngIf",(null==o.Nombre?null:o.Nombre.touched)&&(null==o.Nombre?null:o.Nombre.hasError("required"))),e.xp6(2),e.Q6J("checked",o.checked),e.xp6(7),e.Q6J("ngForOf",o.permisosList),e.xp6(2),e.Q6J("ngxPermissionsOnly",e.DdM(6,E)))},dependencies:[f.sg,f.O5,n._Y,n.Fj,n.JJ,n.JL,n.Q7,n.sg,n.u,c.KE,c.hX,c.TO,T.Nt,C.lW,P.Ub,P.vS,y.oG,R.gE],styles:[".mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%}.full-width-input[_ngcontent-%COMP%]{width:100%}button[_ngcontent-%COMP%]{width:50%}.card[_ngcontent-%COMP%]{padding:2rem}"]});var v=r(9132),F=r(7392);function J(i,t){1&i&&(e.TgZ(0,"th",17),e._uU(1," ID Rol"),e.qZA())}function k(i,t){if(1&i&&(e.TgZ(0,"td",18),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.xp6(1),e.hij(" ",o.rol_id," ")}}function S(i,t){1&i&&(e.TgZ(0,"th",17),e._uU(1," Rol "),e.qZA())}function D(i,t){if(1&i&&(e.TgZ(0,"td",18),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.xp6(1),e.hij(" ",o.nombre," ")}}function Y(i,t){1&i&&(e.TgZ(0,"th",17),e._uU(1," Permisos "),e.qZA())}function q(i,t){if(1&i&&(e.TgZ(0,"td",18),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.xp6(1),e.hij(" ",o.permisos," ")}}function Q(i,t){1&i&&(e.TgZ(0,"th",17),e._uU(1,"Acciones"),e.qZA())}function B(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(o);const s=e.oxw().$implicit,l=e.oxw();return e.KtG(l.editar(s.rol_id,s.nombre,s.permisos))}),e.TgZ(1,"mat-icon",22),e._uU(2,"edit"),e.qZA()()}}function I(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){e.CHM(o);const s=e.oxw().$implicit,l=e.oxw();return e.KtG(l.desactivar(s.rol_id,s.nombre,s.permisos))}),e.TgZ(1,"mat-icon",24),e._uU(2,"delete"),e.qZA()()}}const G=function(){return["editar-rol"]},j=function(){return["desactivar-rol"]};function H(i,t){1&i&&(e.TgZ(0,"td",18),e.YNc(1,B,3,0,"button",19),e.YNc(2,I,3,0,"button",20),e.qZA()),2&i&&(e.xp6(1),e.Q6J("ngxPermissionsOnly",e.DdM(2,G)),e.xp6(1),e.Q6J("ngxPermissionsOnly",e.DdM(3,j)))}function L(i,t){1&i&&e._UZ(0,"tr",25)}function z(i,t){1&i&&e._UZ(0,"tr",26)}function K(i,t){if(1&i&&(e.TgZ(0,"tr",27)(1,"td",28),e._uU(2),e.qZA()()),2&i){e.oxw();const o=e.MAs(10);e.xp6(2),e.hij('No hay resultados de "',o.value,'"')}}const X=function(){return[5,10,25,100]};class u{constructor(t,o,a){this.roleService=t,this.formBuilder=o,this.dialogService=a,this.rolesPermiso={rol_id:0,nombre:"",permisos:[]},this.displayedColumns=["rol_id","nombre","permisos","options"],this.dataSource=new m.by}applyFilter(t){this.dataSource.filter=t.target.value.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}editar(t,o,a){this.rolesPermiso.nombre=o,this.rolesPermiso.rol_id=Number(t),this.rolesPermiso.permisos=a,this.dialogService.open(h,{height:"50rem",width:"60rem",data:this.rolesPermiso}).afterClosed().subscribe(l=>{1===l&&this.cargarRoles()})}ngOnInit(){this.cargarRoles()}cargarRoles(){this.roleService.getRolesPermisos().subscribe(t=>{this.dataSource=new m.by(t)})}desactivar(t,o,a){g().fire({title:"\xbfEsta seguro que desea Desactivar el rol: "+o+"?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Si",denyButtonText:"No"}).then(s=>{s.isConfirmed?this.roleService.desactiveRole(Number(t)).subscribe(l=>{1==l.status&&(this.cargarRoles(),g().fire("Ok!","Rol Desactivado","success"))},l=>{console.log(l)}):s.isDenied&&g().fire("Cambios no guardados","","info")})}}function $(i,t){1&i&&(e.TgZ(0,"mat-error"),e._uU(1,"Nombre de Rol es "),e.TgZ(2,"strong"),e._uU(3,"requerido"),e.qZA()())}function W(i,t){if(1&i&&(e.TgZ(0,"button",12),e._uU(1," Guardar Rol "),e.qZA()),2&i){const o=e.oxw();e.Q6J("disabled",!o.rolForm.valid)}}function V(i,t){if(1&i&&(e.TgZ(0,"mat-list-option",13),e._uU(1),e.qZA()),2&i){const o=t.$implicit;e.Q6J("value",o.id),e.xp6(1),e.hij(" ",o.alias," ")}}u.\u0275fac=function(t){return new(t||u)(e.Y36(Z.N),e.Y36(n.qu),e.Y36(b.uw))},u.\u0275cmp=e.Xpm({type:u,selectors:[["app-roles-page"]],viewQuery:function(t,o){if(1&t&&(e.Gf(N.NW,5),e.Gf(w.YE,5)),2&t){let a;e.iGM(a=e.CRH())&&(o.paginator=a.first),e.iGM(a=e.CRH())&&(o.sort=a.first)}},decls:29,vars:5,consts:[[1,"header"],["mat-fab","","color","accent","routerLink","/rol/create"],["aria-label","add","oncli",""],["matInput","","placeholder","Ex. Mia",3,"keyup"],["input",""],[1,"mat-elevation-z8"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","rol_id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","nombre"],["matColumnDef","permisos"],["matColumnDef","options"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["aria-label","Select page of users",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","matTooltip","Click para Editar","matTooltipPosition","right","color","primary","class","iconbutton",3,"click",4,"ngxPermissionsOnly"],["mat-icon-button","","matTooltip","Click para desactivar","color","warn","class","iconbutton",3,"click",4,"ngxPermissionsOnly"],["mat-icon-button","","matTooltip","Click para Editar","matTooltipPosition","right","color","primary",1,"iconbutton",3,"click"],["aria-label","Edit"],["mat-icon-button","","matTooltip","Click para desactivar","color","warn",1,"iconbutton",3,"click"],["aria-label","Delete"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","4",1,"mat-cell"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"h1"),e._uU(2,"Roles"),e.qZA(),e.TgZ(3,"a",1)(4,"mat-icon",2),e._uU(5,"add"),e.qZA()()(),e.TgZ(6,"mat-form-field")(7,"mat-label"),e._uU(8,"Buscar"),e.qZA(),e.TgZ(9,"input",3,4),e.NdJ("keyup",function(s){return o.applyFilter(s)}),e.qZA()(),e.TgZ(11,"div",5)(12,"table",6),e.ynx(13,7),e.YNc(14,J,2,0,"th",8),e.YNc(15,k,2,1,"td",9),e.BQk(),e.ynx(16,10),e.YNc(17,S,2,0,"th",8),e.YNc(18,D,2,1,"td",9),e.BQk(),e.ynx(19,11),e.YNc(20,Y,2,0,"th",8),e.YNc(21,q,2,1,"td",9),e.BQk(),e.ynx(22,12),e.YNc(23,Q,2,0,"th",8),e.YNc(24,H,3,4,"td",9),e.BQk(),e.YNc(25,L,1,0,"tr",13),e.YNc(26,z,1,0,"tr",14),e.YNc(27,K,3,1,"tr",15),e.qZA(),e._UZ(28,"mat-paginator",16),e.qZA()),2&t&&(e.xp6(12),e.Q6J("dataSource",o.dataSource),e.xp6(13),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns),e.xp6(2),e.Q6J("pageSizeOptions",e.DdM(4,X)))},dependencies:[v.rH,c.KE,c.hX,T.Nt,C.RK,C.EX,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,m.Ee,F.Hw,N.NW,R.gE],styles:["table[_ngcontent-%COMP%]{width:100%;padding:1em}.mat-mdc-form-field[_ngcontent-%COMP%]{font-size:14px;width:100%;max-width:98%;margin:0 auto;display:flex}.full-width-input[_ngcontent-%COMP%]{width:100% auto;padding:1em}.example-section[_ngcontent-%COMP%]{margin:12px}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:1.5rem;padding:0 .4rem;font-family:Roboto,Helvetica Neue,sans-serif}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:inline;padding-top:.6rem;font-weight:400}"]});const ee=function(){return["crear-rol"]};class _{constructor(t,o,a){this.roleService=t,this.formBuilder=o,this.dialogService=a,this.permisos=[],this.idRol=0,this.rol={nombre:""},this.asignacionPermisoRol={rol_id:0,permisos:[]},this.cargarPermisos(),this.buildForm()}cargarPermisos(){this.roleService.getPermisions().subscribe(t=>{this.permisos=t})}buildForm(){this.rolForm=this.formBuilder.group({nombre:["",n.kI.required],permisos:["",[n.kI.required]]})}get Nombre(){return this.rolForm.get("nombre")}get Permisos(){return this.rolForm.get("permisos")}createRol(){this.asignacionPermisoRol.permisos=this.selectedPermision,this.rol.nombre=this.Nombre?.value,this.roleService.createRol(this.rol).subscribe(t=>{1==t.status&&(this.asignacionPermisoRol.rol_id=t.id_rol,this.roleService.assignPermisoToRol(this.asignacionPermisoRol).subscribe(o=>{1==o.status&&g().fire("Ok!",o.message,"success")},o=>{console.log(o)}))})}permisoSelected(t){this.selectedPermision=t.map(o=>o.value)}}_.\u0275fac=function(t){return new(t||_)(e.Y36(Z.N),e.Y36(n.qu),e.Y36(b.uw))},_.\u0275cmp=e.Xpm({type:_,selectors:[["app-new-role-page"]],decls:22,vars:7,consts:[[1,"card"],[1,"card-body"],[3,"formGroup","submit"],[1,"form-group"],["appearance","outline",1,"full-width-input"],["type","text","formControlName","nombre","matInput","","placeholder","qa","required","",1,"form-control"],[4,"ngIf"],["type","submit","mat-raised-button","","color","primary",3,"disabled",4,"ngxPermissionsOnly"],[1,"example-section"],["formControlName","permisos",3,"selectionChange"],["permisosList",""],[3,"value",4,"ngFor","ngForOf"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],[3,"value"]],template:function(t,o){if(1&t){const a=e.EpF();e._UZ(0,"br")(1,"br")(2,"br"),e.TgZ(3,"div",0)(4,"div",1)(5,"form",2),e.NdJ("submit",function(){return o.createRol()}),e.TgZ(6,"div",3)(7,"mat-form-field",4)(8,"mat-label"),e._uU(9,"Ingrese Nombre del Rol"),e.qZA(),e._UZ(10,"input",5),e.YNc(11,$,4,0,"mat-error",6),e.qZA()(),e.TgZ(12,"div",3),e.YNc(13,W,2,1,"button",7),e.qZA(),e._UZ(14,"br")(15,"br"),e.TgZ(16,"div",8)(17,"mat-label"),e._uU(18,"Permisos"),e.qZA(),e.TgZ(19,"mat-selection-list",9,10),e.NdJ("selectionChange",function(){e.CHM(a);const l=e.MAs(20);return e.KtG(o.permisoSelected(l.selectedOptions.selected))}),e.YNc(21,V,2,2,"mat-list-option",11),e.qZA()()()()()}2&t&&(e.xp6(5),e.Q6J("formGroup",o.rolForm),e.xp6(3),e.Udp("font-size",16,"px"),e.xp6(3),e.Q6J("ngIf",(null==o.Nombre?null:o.Nombre.touched)&&(null==o.Nombre?null:o.Nombre.hasError("required"))),e.xp6(2),e.Q6J("ngxPermissionsOnly",e.DdM(6,ee)),e.xp6(8),e.Q6J("ngForOf",o.permisos))},dependencies:[f.sg,f.O5,n._Y,n.Fj,n.JJ,n.JL,n.Q7,n.sg,n.u,c.KE,c.hX,c.TO,T.Nt,C.lW,P.Ub,P.vS,R.gE],styles:[".full-width-input[_ngcontent-%COMP%], button[_ngcontent-%COMP%]{width:100%;max-width:95%;margin:0 auto;display:flex}.example-section[_ngcontent-%COMP%]{max-width:95%;margin:0 auto;display:flex}.example-margin[_ngcontent-%COMP%]{margin:0 12px}ul[_ngcontent-%COMP%]{list-style-type:none;margin-top:4px}"]});const te=[{path:"create",component:_},{path:"",component:u}];class d{}d.\u0275fac=function(t){return new(t||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[v.Bz.forChild(te),v.Bz]});var oe=r(4657);class p{}p.\u0275fac=function(t){return new(t||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[f.ez,d,n.UX,oe.M,y.p9,R.VI.forChild()]})}}]);